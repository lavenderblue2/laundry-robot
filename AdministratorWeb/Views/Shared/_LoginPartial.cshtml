@using Microsoft.AspNetCore.Identity
@using AdministratorWeb.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@if (Context.Request.Path.StartsWithSegments("/dashboard") || Context.Request.Path.StartsWithSegments("/robots") || Context.Request.Path.StartsWithSegments("/users") || Context.Request.Path.StartsWithSegments("/accounting") || Context.Request.Path.StartsWithSegments("/requests"))
{
    <!-- Dark mode admin layout -->
    @if (SignInManager.IsSignedIn(User))
    {
        <div class="flex items-center space-x-6">
            <!-- Notification bell -->
            <button class="relative p-2 text-slate-400 hover:text-white transition-colors duration-200 rounded-lg hover:bg-slate-700/50">
                <i data-lucide="bell" class="w-5 h-5"></i>
                <span class="absolute top-1 right-1 block h-2 w-2 rounded-full bg-indigo-500 ring-2 ring-slate-800"></span>
            </button>
            
            <!-- User menu -->
            <div class="relative">
                <button id="userMenuButton" class="flex items-center space-x-3 p-2 text-sm text-slate-300 hover:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50 rounded-xl transition-all duration-200 hover:bg-slate-700/50">
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <div class="h-9 w-9 rounded-xl bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center shadow-md">
                                <span class="text-white font-semibold text-sm">@User.Identity?.Name?.Substring(0, 1).ToUpper()</span>
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 h-3 w-3 bg-emerald-500 border-2 border-slate-800 rounded-full"></div>
                        </div>
                        <div class="hidden md:block text-left">
                            <div class="text-sm font-medium text-white">@User.Identity?.Name</div>
                            <div class="text-xs text-slate-400">@(User.IsInRole("Administrator") ? "Administrator" : "User")</div>
                        </div>
                        <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 transition-transform duration-200 group-hover:rotate-180"></i>
                    </div>
                </button>
                
                <div id="userDropdown" class="hidden absolute right-0 mt-3 w-64 bg-slate-800/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-slate-700/50 z-50 overflow-hidden">
                    <!-- Profile header -->
                    <div class="p-4 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 border-b border-slate-700/50">
                        <div class="flex items-center space-x-3">
                            <div class="h-12 w-12 rounded-xl bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center">
                                <span class="text-white font-semibold">@User.Identity?.Name?.Substring(0, 1).ToUpper()</span>
                            </div>
                            <div>
                                <div class="text-sm font-semibold text-white">@User.Identity?.Name</div>
                                <div class="text-xs text-slate-400 flex items-center">
                                    <i data-lucide="shield-check" class="w-3 h-3 mr-1"></i>
                                    @(User.IsInRole("Administrator") ? "Administrator" : "User")
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Menu items -->
                    <div class="p-2">
                        <a asp-area="Identity" asp-page="/Account/Manage/Index" class="flex items-center px-3 py-2.5 text-sm text-slate-300 hover:bg-slate-700/50 hover:text-white rounded-xl transition-all duration-200">
                            <i data-lucide="user" class="w-4 h-4 mr-3 text-slate-400"></i>
                            <span>Profile Settings</span>
                            <i data-lucide="external-link" class="w-3 h-3 ml-auto text-slate-500"></i>
                        </a>
                        
                        <a href="#" class="flex items-center px-3 py-2.5 text-sm text-slate-300 hover:bg-slate-700/50 hover:text-white rounded-xl transition-all duration-200">
                            <i data-lucide="settings" class="w-4 h-4 mr-3 text-slate-400"></i>
                            <span>Preferences</span>
                        </a>
                        
                        <a href="#" class="flex items-center px-3 py-2.5 text-sm text-slate-300 hover:bg-slate-700/50 hover:text-white rounded-xl transition-all duration-200">
                            <i data-lucide="help-circle" class="w-4 h-4 mr-3 text-slate-400"></i>
                            <span>Help & Support</span>
                        </a>
                        
                        <div class="h-px bg-slate-700/50 my-2"></div>
                        
                        <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })" method="post" class="block">
                            <button type="submit" class="flex items-center w-full px-3 py-2.5 text-sm text-red-400 hover:bg-red-500/10 hover:text-red-300 rounded-xl transition-all duration-200 text-left">
                                <i data-lucide="log-out" class="w-4 h-4 mr-3"></i>
                                <span>Sign Out</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="flex items-center space-x-4">
            <a asp-area="Identity" asp-page="/Account/Login" class="flex items-center px-4 py-2 text-sm text-slate-400 hover:text-white bg-slate-700/50 hover:bg-slate-600/50 rounded-xl transition-all duration-200">
                <i data-lucide="log-in" class="w-4 h-4 mr-2"></i>
                Login
            </a>
        </div>
    }
}
else
{
    <!-- Light mode public layout -->
    @if (SignInManager.IsSignedIn(User))
    {
        <div class="flex items-center space-x-4">
            <!-- User profile for public pages -->
            <div class="relative">
                <button id="publicUserMenuButton" class="flex items-center space-x-2 px-3 py-2 text-sm font-medium text-slate-700 hover:text-slate-900 bg-slate-50 hover:bg-slate-100 rounded-xl transition-all duration-200">
                    <div class="h-8 w-8 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                        <span class="text-white font-medium text-xs">@User.Identity?.Name?.Substring(0, 1).ToUpper()</span>
                    </div>
                    <span class="hidden sm:block">@User.Identity?.Name</span>
                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                </button>
                
                <div id="publicUserDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-xl border border-slate-200 z-50 overflow-hidden">
                    <div class="p-2">
                        <a asp-controller="Dashboard" asp-action="Index" class="flex items-center px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 rounded-lg transition-colors">
                            <i data-lucide="layout-dashboard" class="w-4 h-4 mr-3 text-slate-400"></i>
                            Dashboard
                        </a>
                        <a asp-area="Identity" asp-page="/Account/Manage/Index" class="flex items-center px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 rounded-lg transition-colors">
                            <i data-lucide="user" class="w-4 h-4 mr-3 text-slate-400"></i>
                            Profile
                        </a>
                        <div class="h-px bg-slate-200 my-1"></div>
                        <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })" method="post" class="block">
                            <button type="submit" class="flex items-center w-full px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 rounded-lg transition-colors text-left">
                                <i data-lucide="log-out" class="w-4 h-4 mr-3 text-slate-400"></i>
                                Sign Out
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="flex items-center space-x-3">
            <a asp-area="Identity" asp-page="/Account/Register" class="px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-900 transition-colors">
                Register
            </a>
            <a asp-area="Identity" asp-page="/Account/Login" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl">
                <i data-lucide="log-in" class="w-4 h-4 mr-2"></i>
                Login
            </a>
        </div>
    }
}